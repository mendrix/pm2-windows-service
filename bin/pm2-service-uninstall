#!node --harmony

'use strict';

const path = require('path');
const fs = require('fs');
const args = require('yargs')
        .usage('Usage: $0 [-n <service name>]')
        .alias('n', 'name')
        .argv;

const pm2ws = require('../src/index');

console.log(`Uninstalling PM2 service with name = ${args.name}`);

// pm2-windows-service stores the service name in a .sid file at a single global location
// when using multiple instances of pm2 as a service, this will not work.
// To force the uninstaller to use the supplied name instead of the name from the .sid file,
// we delete the .sid file before uninstalling.
const save_dir = path.resolve(process.env.APPDATA, 'pm2-windows-service');
const sid_file = path.resolve(save_dir, '.sid');
if (fs.existsSync(sid_file)) {
    fs.unlinkSync(sid_file);
}

// pass supplied name to pm2ws.uninstall
pm2ws.uninstall(args.name).then(_ => {
    console.log('PM2 service uninstalled.');
}, err => {
    console.error('ERROR', err);
    process.exit((err && err.code) || 1);
});
